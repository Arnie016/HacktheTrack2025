{% extends "base.html" %}

{% block title %}ML Models - AI Pit Strategy{% endblock %}

{% block extra_css %}
<style>
    .model-grid {
        display: grid;
        gap: 2rem;
    }
    
    .model-card {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border-left: 5px solid var(--primary);
    }
    
    .model-header {
        display: flex;
        justify-content: space-between;
        align-items: start;
        margin-bottom: 1.5rem;
    }
    
    .model-badge {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.9em;
        font-weight: 600;
    }
    
    .feature-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 1rem 0;
    }
    
    .feature-tag {
        background: #f0f0f0;
        padding: 0.4rem 1rem;
        border-radius: 15px;
        font-size: 0.9em;
        color: #555;
    }
    
    .metric-box {
        display: inline-block;
        background: var(--success);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 600;
        margin-right: 1rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>ü§ñ ML Models</h1>
    <p>7 integrated models analyzing 51 features per lap</p>
</div>

<div class="card">
    <h2>Architecture Overview</h2>
    <p style="font-size: 1.1em; line-height: 1.8; color: #555;">
        The AI Pit Strategy Optimizer integrates 7 specialized machine learning models into a unified decision engine. 
        Each model handles a specific aspect of race strategy, from tire degradation to damage detection to position-aware tactics.
    </p>
</div>

<div class="model-grid" id="models-container">
    <div class="loader">
        <div class="spinner"></div>
        <p style="margin-top: 1rem; color: var(--primary);">Loading model information...</p>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
    async function loadModels() {
        const container = document.getElementById('models-container');
        
        try {
            const response = await fetch('/api/ml_model_info');
            const models = await response.json();
            
            let html = '';
            
            for (const [key, model] of Object.entries(models)) {
                html += `
                    <div class="model-card">
                        <div class="model-header">
                            <div>
                                <h3 style="color: var(--primary); font-size: 1.5em;">${model.name}</h3>
                                <p style="color: #666; margin-top: 0.5rem;">${model.type || model.method}</p>
                            </div>
                            <span class="model-badge">${model.file_size || 'In-memory'}</span>
                        </div>
                        
                        ${model.training_samples ? `<p><strong>Training Data:</strong> ${model.training_samples}</p>` : ''}
                        ${model.simulations_per_decision ? `<p><strong>Simulations:</strong> ${model.simulations_per_decision}</p>` : ''}
                        
                        <h4 style="margin-top: 1.5rem; color: var(--secondary);">Features/Inputs:</h4>
                        <div class="feature-list">
                            ${model.features ? model.features.map(f => `<span class="feature-tag">${f}</span>`).join('') : ''}
                            ${model.inputs ? model.inputs.map(f => `<span class="feature-tag">${f}</span>`).join('') : ''}
                        </div>
                        
                        <h4 style="margin-top: 1.5rem; color: var(--secondary);">Outputs:</h4>
                        <p>${model.outputs}</p>
                        
                        <div style="margin-top: 1.5rem;">
                            ${model.mae ? `<span class="metric-box">MAE: ${model.mae}</span>` : ''}
                            ${model.r2 ? `<span class="metric-box">R¬≤: ${model.r2}</span>` : ''}
                            ${model.concordance ? `<span class="metric-box">Concordance: ${model.concordance}</span>` : ''}
                            ${model.precision ? `<span class="metric-box">Precision: ${model.precision}</span>` : ''}
                            ${model.recall ? `<span class="metric-box">Recall: ${model.recall}</span>` : ''}
                            ${model.agreement_with_crews ? `<span class="metric-box">${model.agreement_with_crews}</span>` : ''}
                            ${model.convergence_time ? `<span class="metric-box">Time: ${model.convergence_time}</span>` : ''}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
        } catch (error) {
            container.innerHTML = `<p style="color: var(--danger);">‚ö†Ô∏è Error loading models: ${error.message}</p>`;
        }
    }
    
    document.addEventListener('DOMContentLoaded', loadModels);
</script>
<style>
    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto;
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    
    .loader {
        text-align: center;
        padding: 3rem;
    }
</style>
{% endblock %}

